@using CafeT.Text
@using CafeT.Time
@using System.Globalization

@model Web.Models.IssueView

@if (Model.IsExpired())
{
    <div id="@Model.Id.ToString()" class="card-box kanban-box">
        <div class="kanban-detail">
            <span class="label label-danger pull-right">Expired</span>
            @if (Model.Title != null && Model.Title.Length > 0)
            {
                <h4><a href="#">@Html.ActionLink(Model.Title, "Details", new { id = Model.Id }, null)</a> </h4>
            }
            <span class="label label-danger pull-right">@Model.End.Value.ToShortDateString()</span>
            <span class="label label-danger pull-right">@Model.End.Value.ToShortTimeString()</span>
            <span class="label label-success pull-right">@Model.IssueEstimation phút</span>
            <div id="Update-@Model.Id"></div>
            <ul class="list-inline m-b-0">
                <li>
                    <a href="#" data-toggle="tooltip" data-placement="top"
                       title="" data-original-title="Username">
                        <img src="assets/images/users/avatar-2.jpg" alt="img"
                             class="thumb-sm img-circle">
                    </a>
                </li>
                <li>
                    <a href="#" data-toggle="tooltip" data-placement="top"
                       title="" data-original-title="5 Tasks">
                        <i class="zmdi zmdi-format-align-left"></i>
                    </a>
                </li>
                <li>
                    <a href="#" data-toggle="tooltip" data-placement="top"
                       title="" data-original-title="3 Comments">
                        <i class="zmdi zmdi-comment-outline"></i>
                    </a>
                </li>
            </ul>
        </div>
        <p>
            <div class="comment-footer">
                @if (User.Identity.IsAuthenticated)
                {
                    @Ajax.ActionLink("Now (+10m) ", "SetWorkOnTime", "WorkIssues", new { id = Model.Id, date = DateTime.Now.AddMinutes(10) },
                            new AjaxOptions
                            {
                                UpdateTargetId = "Update-" + Model.Id.ToString(),
                                HttpMethod = "Post",
                            }, null)
                    @Ajax.ActionLink("Tomorrow", "SetWorkOnTime", "WorkIssues", new { id = Model.Id, date = DateTime.Now.AddDays(1) },
                            new AjaxOptions
                            {
                                UpdateTargetId = "Update-" + Model.Id.ToString(),
                                HttpMethod = "Post",
                            }, null)
                    @Ajax.ActionLink("Done", "MarkAsDone", "WorkIssues", new { id = Model.Id, date = DateTime.Now.AddDays(1) },
                            new AjaxOptions
                            {
                                UpdateTargetId = "Update-" + Model.Id.ToString(),
                                HttpMethod = "Post",
                            }, null)
                    if (User.Identity.Name == Model.CreatedBy)
                    {
                        <a href="#"><i class="fa fa-edit"></i></a>
                        @Ajax.ActionLink("Edit ", "Edit", "WorkIssues", new { id = Model.Id },
                                    new AjaxOptions
                                    {
                                        UpdateTargetId = "Status-" + Model.Id.ToString(),
                                        HttpMethod = "Post",
                                    }, null)
                        @Ajax.ActionLink("Delete ", "Delete", "WorkIssues", new { id = Model.Id },
                                    new AjaxOptions
                                    {
                                        UpdateTargetId = Model.Id.ToString(),
                                        HttpMethod = "Post",
                                        InsertionMode = InsertionMode.Replace
                                    }, null)
                    }
                }
            </div>
        </p>
    </div>
}
